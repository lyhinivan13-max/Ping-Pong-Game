<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Пинг-Понг</title>
  <style>
    :root {
      --bg: #f0f0f0;
      --fg: #333333;
      --accent: #2196F3;
      --paddle: #4CAF50;
      --ball: #FFC107;
      --canvas-bg: #424242;
    }
    body.dark {
      --bg: #1e1e1e;
      --fg: #e0e0e0;
      --accent: #FF9800;
      --paddle: #f44336;
      --ball: #8BC34A;
      --canvas-bg: #212121;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 10px;
      box-sizing: border-box;
      transition: background 0.3s ease, color 0.3s ease;
    }
    header {
      padding: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    select, button {
      padding: 8px 15px;
      border-radius: 20px;
      border: 1px solid var(--accent);
      background: var(--bg);
      color: var(--fg);
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    select:hover, button:hover {
      background: var(--accent);
      color: var(--bg);
    }
    canvas {
      background: var(--canvas-bg);
      border: 5px solid var(--accent);
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      max-width: 95%;
      touch-action: none;
    }
    #scoreboard {
      margin-top: 20px;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid var(--accent);
      padding: 10px;
      border-radius: 10px;
      width: 280px;
      background: var(--bg);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #scoresList {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #scoresList li {
      padding: 5px 0;
      border-bottom: 1px dashed #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #scoresList li:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <header>
    <label>Сложность:
      <select id="difficulty">
        <option value="easy">Легко</option>
        <option value="medium" selected>Средне</option>
        <option value="hard">Сложно</option>
      </select>
    </label>
    <label>Игрок 2:
      <select id="player2Type">
        <option value="ai" selected>Бот</option>
        <option value="human">Человек</option>
      </select>
    </label>
    <button id="themeBtn">Тема: Светлая</button>
    <button id="resetScores">Сбросить рекорды</button>
  </header>
  <canvas id="gameCanvas" width="300" height="400"></canvas>
  <div id="scoreboard">
    <strong>Таблица рекордов</strong>
    <ul id="scoresList"></ul>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let paddleHeight = 80, paddleWidth = 12;
    let leftPaddleY = canvas.height / 2 - paddleHeight / 2;
    let rightPaddleY = canvas.height / 2 - paddleHeight / 2;
    let ballX = canvas.width / 2, ballY = canvas.height / 2;
    let ballRadius = 8;
    let ballSpeedX = 3, ballSpeedY = 2;
    let player1Score = 0;
    let player2Score = 0;
    let aiSpeed = 2.5;
    let player2IsHuman = false;
    let touchStartClientY = null;

    function drawPaddle(x, y, color) {
      ctx.fillStyle = color || getComputedStyle(document.documentElement).getPropertyValue('--paddle');
      ctx.beginPath();
      ctx.roundRect(x, y, paddleWidth, paddleHeight, 5);
      ctx.fill();
    }
    function drawBall(color) {
      ctx.fillStyle = color || getComputedStyle(document.documentElement).getPropertyValue('--ball');
      ctx.beginPath();
      ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.closePath();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--fg');
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      drawPaddle(10, leftPaddleY);
      drawPaddle(canvas.width - paddleWidth - 10, rightPaddleY);
      drawBall();
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--fg');
      ctx.font = '24px "Segoe UI"';
      ctx.fillText(player1Score, canvas.width / 4, 30);
      ctx.fillText(player2Score, canvas.width * 3 / 4 - 15, 30);
      ballX += ballSpeedX;
      ballY += ballSpeedY;
      if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
        ballSpeedY = -ballSpeedY;
      }
      if (ballX - ballRadius < 10 + paddleWidth && ballY > leftPaddleY && ballY < leftPaddleY + paddleHeight) {
        ballSpeedX = -ballSpeedX;
        ballX = 10 + paddleWidth + ballRadius;
      }
      if (ballX + ballRadius > canvas.width - 10 - paddleWidth && ballY > rightPaddleY && ballY < rightPaddleY + paddleHeight) {
        ballSpeedX = -ballSpeedX;
        ballX = canvas.width - 10 - paddleWidth - ballRadius;
      }
      if (ballX < 0) {
        player2Score++;
        resetBall('left');
      } else if (ballX > canvas.width) {
        player1Score++;
        resetBall('right');
      }
      if (!player2IsHuman) {
        if (ballY < rightPaddleY + paddleHeight / 2) rightPaddleY -= aiSpeed;
        else if (ballY > rightPaddleY + paddleHeight / 2) rightPaddleY += aiSpeed;
        if (rightPaddleY < 0) rightPaddleY = 0;
        if (rightPaddleY > canvas.height - paddleHeight) rightPaddleY = canvas.height - paddleHeight;
      }
    }

    function resetBall(lastScorer = 'none') {
      ballX = canvas.width / 2;
      ballY = canvas.height / 2;
      if (lastScorer === 'left') {
        ballSpeedX = Math.abs(ballSpeedX);
      } else if (lastScorer === 'right') {
        ballSpeedX = -Math.abs(ballSpeedX);
      } else {
        ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * 3;
      }
      ballSpeedY = (Math.random() > 0.5 ? 1 : -1) * 2;
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp' && leftPaddleY > 0) leftPaddleY -= 15;
      if (e.key === 'ArrowDown' && leftPaddleY < canvas.height - paddleHeight) leftPaddleY += 15;
      if (player2IsHuman) {
        if (e.key === 'w' && rightPaddleY > 0) rightPaddleY -= 15;
        if (e.key === 's' && rightPaddleY < canvas.height - paddleHeight) rightPaddleY += 15;
      }
    });

    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      const touch = e.touches[0];
      if (touch.clientX < canvas.width / 2 + canvas.offsetLeft) {
        touchStartClientY = touch.clientY;
      }
    });

    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      const touch = e.touches[0];
      if (touchStartClientY !== null && touch.clientX < canvas.width / 2 + canvas.offsetLeft) {
        const deltaY = touch.clientY - touchStartClientY;
        const newPaddleY = leftPaddleY + deltaY;
        if (newPaddleY >= 0 && newPaddleY <= canvas.height - paddleHeight) {
          leftPaddleY = newPaddleY;
        } else if (newPaddleY < 0) {
          leftPaddleY = 0;
        } else if (newPaddleY > canvas.height - paddleHeight) {
          leftPaddleY = canvas.height - paddleHeight;
        }
        touchStartClientY = touch.clientY;
      }
    });

    canvas.addEventListener('touchend', e => {
      e.preventDefault();
      touchStartClientY = null;
    });

    document.getElementById('difficulty').addEventListener('change', e => {
      if (e.target.value === 'easy') aiSpeed = 1.5;
      if (e.target.value === 'medium') aiSpeed = 2.5;
      if (e.target.value === 'hard') aiSpeed = 4;
    });

    document.getElementById('player2Type').addEventListener('change', e => {
      player2IsHuman = (e.target.value === 'human');
    });

    const themeBtn = document.getElementById('themeBtn');
    themeBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      themeBtn.textContent = document.body.classList.contains('dark') ? 'Тема: Тёмная' : 'Тема: Светлая';
    });

    function saveScore(player1Score, player2Score) {
      let scores = JSON.parse(localStorage.getItem('pongScores')) || [];
      scores.push({ player1: player1Score, player2: player2Score, date: new Date().toLocaleString() });
      scores.sort((a,b) => (b.player1 + b.player2) - (a.player1 + a.player2));
      if (scores.length > 5) scores = scores.slice(0,5);
      localStorage.setItem('pongScores', JSON.stringify(scores));
      renderScores();
    }

    function renderScores() {
      const scores = JSON.parse(localStorage.getItem('pongScores')) || [];
      const list = document.getElementById('scoresList');
      list.innerHTML = scores.map(s => `<li>Игрок 1: ${s.player1} - Игрок 2: ${s.player2} (${s.date})</li>`).join('');
    }
    renderScores();

    document.getElementById('resetScores').addEventListener('click', () => {
      localStorage.removeItem('pongScores');
      renderScores();
    });

    function gameLoop() {
      draw();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();
  </script>
</body>
</html>
